{% extends "user_management/base.html" %}

{% block content %}
  <div class="home-container">
    <!-- Button to trigger modal for creating a new post -->
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#sharePostModal">
      Start a Post
    </button>

    <!-- Display form errors if there are any -->
    {% if form.errors %}
      <div class="alert alert-danger">
        <ul>
          {% for field in form %}
            {% for error in field.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <!-- Modal to create a new blog post -->
    <div class="modal fade" id="sharePostModal" tabindex="-1" aria-labelledby="sharePostModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="sharePostModalLabel">Share Your Thoughts</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <!-- Form to create a new blog post -->
            <form method="POST" enctype="multipart/form-data">
              {% csrf_token %}
              <div class="form-group mb-4">
                <label for="id_title" class="form-label">Title</label>
                {{ form.title }}
              </div>

              <div class="form-group mb-4">
                <label for="id_description" class="form-label">Write Something...</label>
                {{ form.description }}
              </div>

              <div class="form-group mb-4">
                <label for="id_blog_image" class="form-label">Add an Image</label>
                {{ form.blog_image }}
              </div>

              <button type="submit" class="btn btn-primary btn-lg w-100">Post</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    
    <hr class="my-5">

    <!-- Display existing blog posts -->
    <div class="posts-list">
      {% for item in posts_with_comments %}
        <div class="row mb-4">
          <div class="col-12">
            <div class="post-item shadow-sm p-3 bg-white rounded">
              <!-- Post User and Avatar -->
              <div class="d-flex align-items-center mb-3">
                <div class="post-user-avatar">
                  {% if item.post.user.profile_pic %}
                    <img src="{{ item.post.user.profile_pic.url }}" height="50px" alt="{{ item.post.user.username }}" class="avatar-img">
                  {% else %}
                    <span class="avatar-placeholder">{{ item.post.user.username|slice:":1" }}</span>
                  {% endif %}
                </div>
                <div class="ms-3">
                  <p class="mb-0 text-primary">        
                    <a href="{% url 'user_profile' item.post.user.username %}">{{ item.post.user.username }}</a>
                  </p>
                  <p class="mb-0 text-muted">{{ item.post.created_at|date:"F d, Y h:i A" }}</p>
                </div>
              </div>
      
              <!-- Post Title and Description -->
              <h4 class="post-title text-dark">
                <a href="{% url 'post_detail' item.post.id %}">{{ item.post.title }}</a>
              </h4>
              <p class="post-description text-muted">{{ item.post.description|truncatewords:30 }}</p>
      
              {% if item.post.blog_image %}
                <div class="post-image mb-3">
                  <img src="{{ item.post.blog_image.url }}" alt="{{ item.post.title }}" class="img-fluid rounded">
                </div>
              {% endif %}
              
              <!-- Like and Dislike Buttons -->
              <div class="post-actions d-flex justify-content-start">
                <a href="{% url 'like_post' item.post.id %}" class="btn btn-outline-success btn-sm me-2">
                  Like ({{ item.post.likes.count }})
                </a>
                <a href="{% url 'dislike_post' item.post.id %}" class="btn btn-outline-danger btn-sm">
                  Dislike ({{ item.post.dislikes.count }})
                </a>
              </div>

              <!-- Comments Section -->
              <div class="comments-section">
                {% for comment in item.comments %}
                  <div class="comment-item mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between">
                      <p class="mb-0"><strong>{{ comment.user.username }}</strong></p>
                      <p class="mb-0 text-muted">{{ comment.created_at|date:"F d, Y h:i A" }}</p>
                    </div>
                    <p>{{ comment.content }}</p>
                  </div>
                {% empty %}
                  <p>No comments yet. Be the first to comment!</p>
                {% endfor %}
              </div>

              <!-- Comment Form -->
              <div class="comment-form">
                <form method="POST" action="{% url 'post_detail' item.post.id %}">
                  {% csrf_token %}
                  {{ comment_form.as_p }}
                  <button type="submit" class="btn btn-outline-primary btn-sm">Post Comment</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <p class="no-posts text-center">No blog posts available. Create one now!</p>
      {% endfor %}
    </div>
  </div>
{% endblock %}

{% block extra_css %}
<style>
  .btn-primary:not(.btn-light)
  {
    color: black;
    margin: .4rem 0;
    font-size: 1.4rem;
    width: 600px;
    flex-grow: 1;
    max-width: none;
    justify-content: left;
    line-height: 1.5;
    border: 1px solid var(--color-border-low-emphasis);
    border-radius: 35px !important;
    padding-left: 1.6rem !important;
  }

  .modal-dialog {
    max-width: 600px;
  }
  .modal-header {
    background-color: #0073b1;
    color: white;
  }
  .modal-title {
    font-weight: bold;
  }

  /* General Container Styling */
  .home-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
    background-color: #f7f7f7;
    font-family: 'Arial', sans-serif;
  }

  /* Title Styling */
  h3 {
    font-size: 2.4em;
    color: #333;
    font-weight: bold;
  }

  /* Card styling for the form */
  .card {
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Input fields and labels */
  .form-group label {
    font-size: 1.1em;
    color: #555;
  }

  .form-control {
    border-radius: 5px;
    padding: 10px;
    font-size: 1em;
    width: 100%;
    margin-top: 5px;
  }

  .form-control:focus {
    border-color: #007bff;
    box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
  }

  /* Textarea specific styling */
  .form-group textarea.form-control {
    height: 150px;
    resize: vertical;
  }

  /* Post item card styling */
  .post-item {
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s;
  }

  .post-item:hover {
    transform: translateY(-5px);
  }

  /* Post Title Styling */
  .post-title {
    font-size: 1.6em;
    color: #333;
    margin-bottom: 15px;
  }

  /* Post Description Styling */
  .post-description {
    font-size: 1.1em;
    color: #666;
    margin-bottom: 15px;
  }

  /* Avatar Image Styling */
  .post-user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #007bff;
  }

  .avatar-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .avatar-placeholder {
    display: flex;
    justify-content: center;
    align-items: center;
    color: #fff;
    font-size: 20px;
    font-weight: bold;
    height: 100%;
  }

  /* Post Date Styling */
  .post-date {
    font-size: 0.9em;
    color: #888;
  }

  /* Buttons Styling */
  .btn {
    padding: 8px 20px;
    border-radius: 20px;
  }

  .btn-outline-success {
    border: 1px solid #28a745;
    color: #28a745;
  }

  .btn-outline-success:hover {
    background-color: #28a745;
    color: white;
  }

  .btn-outline-danger {
    border: 1px solid #dc3545;
    color: #dc3545;
  }

  .btn-outline-danger:hover {
    background-color: #dc3545;
    color: white;
  }

  /* No Posts Message */
  .no-posts {
    font-size: 1.2em;
    color: #888;
    text-align: center;
  }

  /* Button Styling */
  .btn-primary {
    background-color: #0073b1;
    border-color: #0073b1;
    color: white;
    padding: 12px;
    font-size: 1.1em;
    border-radius: 25px;
    font-weight: 600;
  }

  .btn-primary:hover {
    background-color: #005f8c;
    border-color: #005f8c;
    transition: background-color 0.3s ease;
  }

  .btn-primary:focus {
    box-shadow: 0 0 4px rgba(0, 115, 177, 0.5);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .home-container {
      padding: 20px;
    }

    .post-item {
      margin-bottom: 20px;
    }

    .posts-list {
      padding: 0;
    }
  }
</style>
{% endblock %}
